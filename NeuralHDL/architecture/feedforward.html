<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Feedforward | NeuralHDL</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.5.2">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-mermaid-2/bower_components/mermaid/dist/mermaid.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-katex/katex.min.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../architecture/update.html" />
    
    
    <link rel="prev" href="../architecture/stage.html" />
    

        <script src="../gitbook/plugins/gitbook-plugin-mermaid-2/bower_components/mermaid/dist/mermaid.min.js"></script><link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-mermaid-2/bower_components/mermaid/dist/mermaid.forest.css"></link>
    </head>
    <body>
        
        
    <div class="book" data-level="3.1.1" data-chapter-title="Feedforward" data-filepath="architecture/feedforward.md" data-basepath=".." data-revision="Thu Jul 20 2017 17:12:06 GMT-0700 (PDT)">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="introduction/index.html">
            
                
                    <a href="../introduction/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Introduction
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="introduction/getting-started.html">
            
                
                    <a href="../introduction/getting-started.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Getting Started
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="introduction/basic-example.html">
            
                
                    <a href="../introduction/basic-example.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Examples
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="introduction/background.html">
            
                
                    <a href="../introduction/background.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Background
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="dsl/index.html">
            
                
                    <a href="../dsl/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Tool Usage
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="architecture/index.html">
            
                
                    <a href="../architecture/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Hardware Architecture
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="architecture/stage.html">
            
                
                    <a href="../architecture/stage.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Neural Stage
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="3.1.1" data-path="architecture/feedforward.html">
            
                
                    <a href="../architecture/feedforward.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.1.</b>
                        
                        Feedforward
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="architecture/update.html">
            
                
                    <a href="../architecture/update.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.2.</b>
                        
                        Tap Update
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="architecture/backpropagate.html">
            
                
                    <a href="../architecture/backpropagate.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.</b>
                        
                        Error Back Propagation
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="architecture/memory.html">
            
                
                    <a href="../architecture/memory.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.4.</b>
                        
                        Memory Layout
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="architecture/future.html">
            
                
                    <a href="../architecture/future.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Future Directions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="blocks/index.html">
            
                
                    <a href="../blocks/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Building Blocks
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="blocks/simple.html">
            
                
                    <a href="../blocks/simple.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Basic Block Example
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="blocks/test.html">
            
                
                    <a href="../blocks/test.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        Basic Test Example
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="blocks/Neuron.html">
            
                
                    <a href="../blocks/Neuron.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        Neuron
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="blocks/Sigmoid.html">
            
                
                    <a href="../blocks/Sigmoid.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        Sigmoid
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="blocks/NeuralStage.html">
            
                
                    <a href="../blocks/NeuralStage.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        Neural Stage
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="language/index.html">
            
                
                    <a href="../language/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Language Description
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >NeuralHDL</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="feedforward-operation">Feedforward operation</h1>
<p>The feedforward operation consists of a matrix multiplication, bias addition and nonlinear operation. </p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mi>f</mi><mo>(</mo><mi>H</mi><mi>x</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">y = f(Hx + b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="mord mathit">x</span><span class="mbin">+</span><span class="mord mathit">b</span></span></span></span>)</p>
<p>This is done using MAC units in parallel and a vector bias addition and non-linear operation serially. </p>
<hr>
<p>A block diagram of the operation is shown below. The block contains N shared MAC units, a delay line, a bias addition followed by a non-linearity. The input data comes in serially and the output data is converted to parallel through the delay line. </p>
<div class="mermaid">
graph LR
    Add(+)
        Mult(*)

        subgraph MACN
        Mult--&gt;Add
        Data0--&gt;Mult
        Tap--&gt;Mult
        end

       subgraph MAC0
        Mult1(*)--&gt;Add1(+)
        DataN--&gt;Mult1
        Tap1--&gt;Mult1
        end

        subgraph DelayLine
        Add--&gt;Rn
        Add1--&gt;R0
        end

        Data--&gt;Data0
        Data--&gt;DataN
        R0 --&gt;BiasAdd(+)
        TapDelay--&gt;BiasAdd
        BiasAdd--&gt;Output
</div>


<h2 id="data-flow">Data Flow</h2>
<p>The data flow of the system is selected to avoid an adder tree and minimimize memory access. This ordering is shown below when the number of MAC units can split the matrix in 4 sections. </p>
<hr>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mn>1</mn><mi>s</mi><mi>t</mi></mrow></mtd><mtd><mrow><mn>2</mn><mi>n</mi><mi>d</mi></mrow></mtd></mtr><mtr><mtd><mrow><mn>3</mn><mi>r</mi><mi>d</mi></mrow></mtd><mtd><mrow><mn>4</mn><mi>t</mi><mi>h</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\left(\begin{matrix}
  1st &amp; 2nd \\
  3rd &amp; 4th
\end{matrix}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.45em;"></span><span class="strut bottom" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="base textstyle uncramped"><span class="minner textstyle uncramped"><span class="mopen style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="mord textstyle uncramped"><span class="mord mathrm">1</span><span class="mord mathit">s</span><span class="mord mathit">t</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="mord textstyle uncramped"><span class="mord mathrm">3</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">d</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="mord textstyle uncramped"><span class="mord mathrm">2</span><span class="mord mathit">n</span><span class="mord mathit">d</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="mord textstyle uncramped"><span class="mord mathrm">4</span><span class="mord mathit">t</span><span class="mord mathit">h</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span></span><span class="mclose style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></p>
<hr>
<ol>
<li>The input data is multiplied by the taps with the data being input at 1 sample per input </li>
<li>The accumulator takes the previous results unless it is the first input sample</li>
<li>When the summation is complete the parallel outputs are latched into a delay line</li>
<li>The delay line is fed serially into the bias circuit. </li>
<li>The output of the bias addition block is fed into the nonlinearity and output serially</li>
</ol>
<hr>
<p>The access ordering is shown in the table below for an example which has K MAC units and N total inputs. The ordering is always done so that an output is completed without having to be stored back into memory. </p>
<table>
<thead>
<tr>
<th>Type</th>
<th style="text-align:center">0</th>
<th style="text-align:right">1</th>
<th style="text-align:right">K</th>
<th style="text-align:right">K+1</th>
<th style="text-align:right">N</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tap (Vector)</td>
<td style="text-align:center">T0</td>
<td style="text-align:right">T1</td>
<td style="text-align:right">TK</td>
<td style="text-align:right">T(K+1)</td>
<td style="text-align:right">TN</td>
</tr>
<tr>
<td>Data</td>
<td style="text-align:center">D0</td>
<td style="text-align:right">D1</td>
<td style="text-align:right">DK</td>
<td style="text-align:right">D0</td>
<td style="text-align:right">DK</td>
</tr>
<tr>
<td>Bias</td>
<td style="text-align:center">B0</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">BK</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">BK</td>
</tr>
</tbody>
</table>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../architecture/stage.html" class="navigation navigation-prev " aria-label="Previous page: Neural Stage"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../architecture/update.html" class="navigation navigation-next " aria-label="Next page: Tap Update"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-mermaid-2/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"mermaid-2":{"theme":"forest"},"katex":{},"highlight":{},"search":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
