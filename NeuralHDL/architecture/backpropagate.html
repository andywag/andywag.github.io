<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Error Back Propagation | NeuralHDL</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.5.2">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-mermaid-2/bower_components/mermaid/dist/mermaid.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-katex/katex.min.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../architecture/memory.html" />
    
    
    <link rel="prev" href="../architecture/update.html" />
    

        <script src="../gitbook/plugins/gitbook-plugin-mermaid-2/bower_components/mermaid/dist/mermaid.min.js"></script><link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-mermaid-2/bower_components/mermaid/dist/mermaid.forest.css"></link>
    </head>
    <body>
        
        
    <div class="book" data-level="2.1.3" data-chapter-title="Error Back Propagation" data-filepath="architecture/backpropagate.md" data-basepath=".." data-revision="Thu Jul 20 2017 18:38:06 GMT-0700 (PDT)">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="introduction/index.html">
            
                
                    <a href="../introduction/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Introduction
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="introduction/getting-started.html">
            
                
                    <a href="../introduction/getting-started.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Getting Started
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="introduction/basic-example.html">
            
                
                    <a href="../introduction/basic-example.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Examples
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="introduction/background.html">
            
                
                    <a href="../introduction/background.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Background
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="architecture/index.html">
            
                
                    <a href="../architecture/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Hardware Architecture
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="architecture/stage.html">
            
                
                    <a href="../architecture/stage.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Neural Stage
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="architecture/feedforward.html">
            
                
                    <a href="../architecture/feedforward.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.1.</b>
                        
                        Feedforward
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="architecture/update.html">
            
                
                    <a href="../architecture/update.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.2.</b>
                        
                        Tap Update
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="2.1.3" data-path="architecture/backpropagate.html">
            
                
                    <a href="../architecture/backpropagate.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.3.</b>
                        
                        Error Back Propagation
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="architecture/memory.html">
            
                
                    <a href="../architecture/memory.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.4.</b>
                        
                        Memory Layout
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="architecture/future.html">
            
                
                    <a href="../architecture/future.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Future Directions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="blocks/index.html">
            
                
                    <a href="../blocks/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Building Blocks
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="blocks/simple.html">
            
                
                    <a href="../blocks/simple.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Basic Block Example
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="blocks/test.html">
            
                
                    <a href="../blocks/test.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Basic Test Example
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="blocks/Neuron.html">
            
                
                    <a href="../blocks/Neuron.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Neuron
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="blocks/Sigmoid.html">
            
                
                    <a href="../blocks/Sigmoid.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        Sigmoid
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="blocks/NeuralStage.html">
            
                
                    <a href="../blocks/NeuralStage.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        Neural Stage
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="dsl/index.html">
            
                
                    <a href="../dsl/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Tool Usage
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="language/index.html">
            
                
                    <a href="../language/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Language Description
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >NeuralHDL</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h2 id="back-propagation">Back Propagation</h2>
<p>Back propagation uses the same structure as the feedforward and tap update algorithm using the following equation </p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mi>n</mi></msub><mo>=</mo><mo>(</mo><msubsup><mi>H</mi><mi>n</mi><mi>T</mi></msubsup><mo>&#x2217;</mo><msub><mi>e</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">e_n = (H^T_n * e_{n+1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8413309999999999em;"></span><span class="strut bottom" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">e</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">n</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mrel">=</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist"><span style="top:0.247em;margin-left:-0.08125em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">n</span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight" style="margin-right:0.13889em;">T</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mbin">&#x2217;</span><span class="mord"><span class="mord mathit">e</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord scriptstyle cramped mtight"><span class="mord mathit mtight">n</span><span class="mbin mtight">+</span><span class="mord mathrm mtight">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p>This algorithm differs in that it uses the transpose of the taps which requires some reordering to avoid the need of an adder tree. The block diagram is show below. </p>
<hr>
<div class="mermaid">
graph LR
    Add(+)
    Mult(*)

    subgraph MACN
    Mult--&gt;Add
    Data0--&gt;Mult
    Tap--&gt;Mult
    end

   subgraph MAC0
    Mult1(*)--&gt;Add1(+)
    DataN--&gt;Mult1
    Tap1--&gt;Mult1
    end

    subgraph DelayLine
    Add--&gt;Rn
    Add1--&gt;R0
    end

    Data--&gt;Data0
    Data--&gt;DataN
    R0 --&gt;BiasAdd(+)
    Bias--&gt;BiasAdd
    BiasAdd--&gt;Nonlinearity
    Nonlinearity--&gt;Output
</div>

<h2 id="data-flow">Data Flow</h2>
<p>The data flow for this operation is as follows : </p>
<ol>
<li>The vector version of the error is brought in through the tap input and latched into a delay line</li>
<li>The taps are brought in with an offset to order properly align the data and taps </li>
<li>The taps are multiplied by the error and fed to the accumulator</li>
<li>For each sample the data is rotated after each multiply to line up with the correct tap</li>
<li>When the calculation is complete the output of the accumulator is fed into a delay line and output serially</li>
</ol>
<hr>
<p>There is an issue with this algorithm in that it uses the transpose of the taps which slightly complicates the memory access. To get around this problem while keeping the same structure the taps are accessed from memory in an interleaved fashion as shown below. The table below shows this operation which does the following things : </p>
<ol>
<li>Rotates the tap address on a per tap basis</li>
<li>Rotates the data as well using a delay line</li>
</ol>
<hr>
<table>
<thead>
<tr>
<th>Type</th>
<th style="text-align:center">0</th>
<th style="text-align:right">1</th>
<th style="text-align:right">K</th>
<th style="text-align:right">K+1</th>
<th style="text-align:right">N</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tap0</td>
<td style="text-align:center">T0</td>
<td style="text-align:right">T1</td>
<td style="text-align:right">TK</td>
<td style="text-align:right">T(K+1)</td>
<td style="text-align:right">TN</td>
</tr>
<tr>
<td>Tap1</td>
<td style="text-align:center">T1</td>
<td style="text-align:right">T2</td>
<td style="text-align:right">T0</td>
<td style="text-align:right">T(K+1)</td>
<td style="text-align:right">TN</td>
</tr>
<tr>
<td>TapK</td>
<td style="text-align:center">TK</td>
<td style="text-align:right">T0</td>
<td style="text-align:right">T1</td>
<td style="text-align:right">T(K+1)</td>
<td style="text-align:right">TN</td>
</tr>
<tr>
<td>Data0</td>
<td style="text-align:center">E0</td>
<td style="text-align:right">E1</td>
<td style="text-align:right">EK</td>
<td style="text-align:right">..</td>
<td style="text-align:right">..</td>
</tr>
<tr>
<td>Data1</td>
<td style="text-align:center">E1</td>
<td style="text-align:right">E0</td>
<td style="text-align:right">E1</td>
<td style="text-align:right">..</td>
<td style="text-align:right">..</td>
</tr>
<tr>
<td>DataK</td>
<td style="text-align:center">E2</td>
<td style="text-align:right">E2</td>
<td style="text-align:right">EK+1</td>
<td style="text-align:right">..</td>
<td style="text-align:right">..</td>
</tr>
</tbody>
</table>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../architecture/update.html" class="navigation navigation-prev " aria-label="Previous page: Tap Update"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../architecture/memory.html" class="navigation navigation-next " aria-label="Next page: Memory Layout"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-mermaid-2/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"mermaid-2":{"theme":"forest"},"katex":{},"highlight":{},"search":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
